<!DOCTYPE html>
<html>
<head>
    <title>üîí Secure File Upload System</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 700px; 
            margin: 30px auto; 
            padding: 20px; 
        }
        .header { 
            background: #f8f9fa; 
            padding: 15px; 
            border-radius: 5px; 
            margin-bottom: 20px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
        }
        .upload-form { 
            border: 2px dashed #28a745; 
            padding: 20px; 
            text-align: center; 
            margin: 20px 0; 
            border-radius: 5px; 
        }
        input[type="file"] { 
            margin: 10px 0; 
            padding: 5px; 
        }
        input[type="submit"] { 
            background-color: #28a745; 
            color: white; 
            padding: 12px 25px; 
            border: none; 
            cursor: pointer; 
            font-size: 16px; 
            border-radius: 4px; 
        }
        input[type="submit"]:hover { 
            background-color: #218838; 
        }
        .security-info { 
            background: #d1ecf1; 
            padding: 15px; 
            border-radius: 5px; 
            margin: 15px 0; 
        }
        .logout-btn { 
            background: #dc3545; 
            color: white; 
            padding: 8px 15px; 
            text-decoration: none; 
            border-radius: 4px; 
        }
        .flash-messages {
            margin-bottom: 20px;
        }
        .flash-success {
            background: #d4edda;
            color: #155724;
            padding: 10px;
            border-radius: 4px;
            margin: 5px 0;
        }
        .flash-error {
            background: #f8d7da;
            color: #721c24;
            padding: 10px;
            border-radius: 4px;
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <div class="header">
        <div>
            <h1>üîí Secure File Upload System</h1>
            <small>Welcome, {{ username }}!</small>
        </div>
        <a href="/logout" class="logout-btn">Logout</a>
    </div>
    
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="flash-messages">
                {% for category, message in messages %}
                    <div class="flash-{{ category }}">{{ message }}</div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}
    
    <div class="security-info">
        <strong>üõ°Ô∏è Security Features Active:</strong><br>
        ‚Ä¢ Authentication required<br>
        ‚Ä¢ File type validation ({{ allowed_extensions|join(', ') }})<br>
        ‚Ä¢ File size limit: {{ max_file_size_mb }}MB<br>
        ‚Ä¢ Path traversal protection<br>
        ‚Ä¢ Filename sanitization
    </div>
    
    <div class="upload-form">
        <form action="/upload" method="post" enctype="multipart/form-data">
            <p><strong>Select a secure file to upload:</strong></p>
            <input type="file" name="file" required accept="{{ file_accept_types }}">
            <br><br>
            <input type="submit" value="üîê Upload Securely">
        </form>
    </div>
    
    <h2>üìÅ File Management:</h2>
    <div style="border: 1px solid #ddd; padding: 15px; margin: 20px 0; border-radius: 5px;">
        <p><a href="/list-files" style="color: #28a745; text-decoration: none; font-weight: bold;">üìÇ View Uploaded Files</a></p>
    </div>
    
    <div class="security-info">
        <strong>üîç Security Improvements:</strong><br>
        ‚Ä¢ All file access now requires authentication<br>
        ‚Ä¢ Malicious file uploads are blocked<br>
        ‚Ä¢ Path traversal attacks are prevented<br>
        ‚Ä¢ Secure filename handling implemented
    </div>
</body>
</html>